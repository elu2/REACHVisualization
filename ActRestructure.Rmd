---
title: "ActRestructure"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(sqldf)
library(dplyr)
```

```{r Initialize rbinding base table}
file_names <- list.files(path="C:/Users/ericj/metabolite_files/metabolite_tsvs/")
print(length(file_names))
base <- read.table(sprintf("C:/Users/ericj/metabolite_files/metabolite_tsvs/%s", file_names[1]), sep="\t", header=TRUE, fill=TRUE, quote="\"")[c(1:5, 19)]
base
```

```{r rbind all subsequent files}
i = 0
for (file in file_names[2:length(file_names)]){
  
  if (i %% 100 == 0){
    print(i)
  }
  
  binder <- read.table(sprintf("C:/Users/ericj/metabolite_files/metabolite_tsvs/%s", file), sep="\t", header=TRUE, fill=TRUE, quote="\"")[c(1:5, 19)]
  base <- rbind(base, binder)
  i = i + 1
}

df <- data.frame(base)

# Rename columns without period incompatibilities
colnames(df) <- c("INPUT", "OUTPUT", "CONTROLLER", "EVENT_ID", "EVENT_LABEL", "SEEN_IN")

# Remove anomalous rows
df <- sqldf("SELECT * FROM df WHERE SEEN_IN != ''")

df
```

```{r Find Unique Inputs}
# Number of unique pairs
sqldf("SELECT COUNT(*) from (SELECT distinct INPUT,CONTROLLER FROM df)")
```

```{r Only Pos Neg Activations}
# Here, all "NONE" Controllers are omitted. So, transcription, sumoylation, etc. are not in this dataframe.
pos_neg_counted_df <- sqldf("SELECT INPUT, OUTPUT, CONTROLLER, EVENT_LABEL, COUNT(*) AS COUNTER, SEEN_IN FROM df WHERE CONTROLLER!='NONE' GROUP BY OUTPUT, CONTROLLER, EVENT_LABEL ORDER BY COUNTER DESC")

pos_neg_counted_df
```

```{r Writer's Block}
# All Pos/Neg Activation event pairs
write.csv(pos_neg_counted_df, file = "C:/Users/ericj/metabolite_files/GephiVizFiles/ActCount_df.csv", row.names=FALSE)
```